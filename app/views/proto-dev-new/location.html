{% extends "layouts/proto-dev-new.html" %}
{% set displayBacklink = true %}

{% from "/" + folder + "/components/toggletip/macro.njk" import toggletip %}
{% from "/" + folder + "/components/aq-levels-table/macro.njk" import aqLevelsTable %}
{% from "/" + folder + "/components/aq-tabs/macro.njk" import aqTabs %}
{% from  "/" + folder + "/components/search/macro.njk" import appSearch %}
{% from  "/" + folder + "/components/pollutant-levels/macro.njk" import appPollutantLevels %}

{% set caption = "" %}
{% macro getParentArea(result) %}
  {% if result.GAZETTEER_ENTRY.LOCAL_TYPE == 'Postcode' %}
    {{ result.populatedPlace | default("", true) | trim | safe }}
  {% else %}
    {{ (result.GAZETTEER_ENTRY.DISTRICT_BOROUGH if result.GAZETTEER_ENTRY.DISTRICT_BOROUGH else result.GAZETTEER_ENTRY.COUNTY_UNITARY) | default("", true) | trim | safe }}
  {% endif %}
{% endmacro %}

{% set locationName = result.GAZETTEER_ENTRY.NAME1 | default("", true) | trim | safe %}
{% set parentArea = getParentArea(result) %}
{% set title = "Air pollution in " ~ locationName ~ (", " ~ parentArea if parentArea else "") %}
{% set servicePage = true %}
{% set pageHeadingSize = pageHeadingSize or "xl" %}

{% set day2 = 1 | addDaysToTodayAbrev %}
{% set day3 = 2 | addDaysToTodayAbrev %}
{% set day4 = 3 | addDaysToTodayAbrev %}
{% set day5 = 4 | addDaysToTodayAbrev %}

{% set day2b = 1 | addDaysToTodayFull %}
{% set day3b = 2 | addDaysToTodayFull %}
{% set day4b = 3 | addDaysToTodayFull %}
{% set day5b = 4 | addDaysToTodayFull %}

{% block pageScripts %}
  <script src="/public/javascripts/toggletips.js"></script>
{% endblock %}

{% block content %}
  <div class="govuk-grid-row" data-module="edge">
    <div class="govuk-grid-column-full-until-desktop govuk-grid-column-two-thirds-from-desktop">

      <h1 class="govuk-heading-{{ pageHeadingSize }}">
          {{ title }}  
          
      <h2 class="govuk-heading-m">Predicted air pollution levels</h2>
    
      <!---------- TABBED FORECAST ---------->

      <div class="govuk-tabs" data-module="govuk-tabs">
        <h2 class="govuk-tabs__title">
          Contents
        </h2>

        <!------ TABS ------>

        <ul class="govuk-tabs__list">
          <li class="govuk-tabs__list-item govuk-tabs__list-item--selected">
            <a class="govuk-tabs__tab" href="#today">
              Today
            </a>
          </li>
          <li class="govuk-tabs__list-item">
            <a class="govuk-tabs__tab" href="#day2">
              {{ day2 }}
            </a>
          </li>
          <li class="govuk-tabs__list-item">
            <a class="govuk-tabs__tab" href="#day3">
              {{ day3 }}
            </a>
          </li>
          <li class="govuk-tabs__list-item">
            <a class="govuk-tabs__tab" href="#day4">
              {{ day4 }}
            </a>
          </li>
          <li class="govuk-tabs__list-item">
            <a class="govuk-tabs__tab" href="#day5">
              {{ day5 }}
            </a>
          </li>
        </ul>

        <!------ TAB PANEL ------>

        <!--Today-->
        <div class="govuk-tabs__panel" id="today">
          <h2 class="govuk-heading-m">Today</h2>
          
          {% include "/" + folder + "/includes/daqi-new.html" %}

          <p class="govuk-!-margin-top-6">{{ airQuality.today.ukToday }}</p>

        </div>

        <!--Tomorrow-->
        <div class="govuk-tabs__panel govuk-tabs__panel--hidden" id="day2">
          <h2 class="govuk-heading-m">{{ day2b }}</h2>
          

          {% include "/" + folder + "/includes/daqi-day2.html" %}

          <p class="govuk-!-margin-top-6">{{ airQuality.today.ukTomorrow }}</p>         

        </div>

        <!--Day 3-->
        <div class="govuk-tabs__panel govuk-tabs__panel--hidden" id="day3">
          <h2 class="govuk-heading-m">{{ day3b }}</h2>

          {% include "/" + folder + "/includes/daqi-day3.html" %}

          <p class="govuk-!-margin-top-6">{{ airQuality.today.ukOutlook }}</p>

        </div>

        <!--Day 4-->
        <div class="govuk-tabs__panel govuk-tabs__panel--hidden" id="day4">
          <h2 class="govuk-heading-m">{{ day4b }}</h2>

          {% include "/" + folder + "/includes/daqi-day4.html" %}

          <p class="govuk-!-margin-top-6">{{ airQuality.today.ukOutlook }}</p>

        </div>

        <!--Day 5-->
        <div class="govuk-tabs__panel govuk-tabs__panel--hidden" id="day5">
          <h2 class="govuk-heading-m">{{ day5b }}</h2>

          {% include "/" + folder + "/includes/daqi-day5.html" %}

          <p class="govuk-!-margin-top-6">{{ airQuality.today.ukOutlook }}</p>

        </div>

        <p class="govuk-caption-s govuk-!-margin-top-4">Last updated today at 5am</p>

      </div>
      <!---------- END TABS ------------>

      <!--------- PAGE SECTIONS -------->
      <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-6">

      {% include "/" + folder + "/includes/air-quality-alerts.html" %}

      <div class="govuk-!-padding-bottom-2"></div> <!-- <<< SPACER -->

      <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-6">

      {% include "/" + folder + "/includes/reduce-your-exposure.html" %}

      <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-6">
  
      {% include "/" + folder + "/includes/health-advice.html" %}

      <div class="govuk-!-padding-bottom-9"></div>

    </div>


  <!-- RELATED CONTENT 
  <div class="govuk-grid-column-full-until-desktop govuk-grid-column-one-third-from-desktop">
      
    {{ xGovukRelatedNavigation({
      sections: [{
          items: [{
              text: "Health effects of air pollution",
              href: "/" + version + "/health-effects?locationName=" + locationName
          },
          {
            text: "Actions to reduce your exposure to air pollution",
            href: "/" + version + "/actions?locationName=" + locationName
          },
          {
            text: "Air pollution breaches",
            href: "/" + version + "/alerts?locationName=" + locationName
          }
          ]
      }]
  }) }}
  
  </div>
  
  END RELATED CONTENT -->

</div>

<!-- UR SCENARIO LINKS (to test different versions of the location page )
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full app-contact-panel govuk-!-margin-bottom-6" >
    <h3 class="govuk-heading-s">User research scenarios</h3>
      <span class="govuk-body-s"><a class="govuk-link" href="/{{ version }}/location-high?locationName={{ locationName }}&parentArea={{ parentArea }}">Research scenario 1</a>     </span>
      <span class="govuk-body-s"><a class="govuk-link" href="/{{ version }}/location-veryhigh?locationName={{ locationName }}&parentArea={{ parentArea }}">Research scenario 2</a></span>
  </div>
</div>
<!--END UR LINKS -->

{% endblock %}